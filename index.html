<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ERP Pro - Full Version</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { 
            --border: #e0e0e0;
            --bg-main: #ffffff;
            --bg-soft: #f9f9f9;
            --primary: #1a73e8;
            --text: #3c4043;
            --danger: #d93025;
        }
        /* CSS Dark Mode */
        body.dark-mode {
            --bg-main: #121212;
            --bg-soft: #1e1e1e;
            --text: #e0e0e0;
            --border: #333333;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { margin: 0; background: var(--bg-main); overflow: hidden; display: flex; flex-direction: column; height: 100vh; color: var(--text); transition: background 0.3s; }

        /* Header & Sidebar */
        header { padding: 0 15px; border-bottom: 1px solid var(--border); display: flex; align-items: center; background: var(--bg-main); height: 50px; justify-content: space-between; }
        #sidebar { 
            width: 280px; background: var(--bg-main); position: fixed; left: -280px; height: 100%; 
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1100; border-radius: 0 30px 30px 0; 
            display: flex; flex-direction: column; box-shadow: 15px 0 50px rgba(0,0,0,0.1);
        }
        #sidebar.active { left: 0; }
        .sidebar-header { padding: 30px 25px 10px; font-weight: 800; font-size: 18px; color: var(--text); letter-spacing: 1px; }

        /* Buttons & Tab Sidebar */
        .tab-btn { 
            width: 100%; padding: 20px 25px; border: none; background: none; 
            text-align: left; cursor: pointer; font-size: 16px; font-weight: 700;
            color: var(--text); letter-spacing: 0.5px; transition: 0.2s;
        }
        .tab-btn.active { color: var(--primary); background: rgba(26, 115, 232, 0.1); }
        .btn-ui { padding: 8px 16px; border: 1px solid var(--border); background: var(--bg-main); color: var(--text); border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer; transition: 0.2s; }
        .btn-ui:hover { background: var(--bg-soft); }
        .btn-primary { background: var(--primary) !important; color: #fff !important; border: none !important; }

        /* Toolbar */
        .toolbar { display: flex; align-items: center; gap: 8px; background: var(--bg-soft); padding: 8px 15px; border-bottom: 1px solid var(--border); overflow-x: auto; white-space: nowrap; }
        .input-ui { padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; outline: none; background: var(--bg-main); color: var(--text); }

        /* Table Style */
        .table-container { flex-grow: 1; overflow: auto; background: var(--bg-main); }
        table { border-collapse: collapse; width: auto; min-width: 100%; table-layout: fixed; }
        th { background: var(--bg-soft); padding: 0; border: 1px solid var(--border); font-size: 12px; font-weight: 600; position: sticky; top: 0; z-index: 10; text-transform: uppercase; color: var(--text); }
        .th-inner { display: flex; align-items: center; justify-content: space-between; padding: 10px; cursor: pointer; }
        td { border: 1px solid var(--border); padding: 0; height: 38px; }
        td input { border: none; padding: 0 10px; font-size: 14px; outline: none; background: transparent; width: 100%; height: 100%; color: var(--text); }
        .row-num { width: 50px; background: var(--bg-soft); text-align: center; font-size: 11px; font-weight: bold; color: var(--primary); cursor: pointer; border-right: 1px solid var(--border); }

        /* Login Screen */
        #login-screen {
            position: fixed; inset: 0; background: var(--bg-main); z-index: 5000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* Bottom Sheets */
        .sheet { 
            position: fixed; bottom: -100%; left: 0; right: 0; background: var(--bg-main); 
            z-index: 2000; border-radius: 24px 24px 0 0; padding: 20px; 
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); max-width: 600px; margin: 0 auto;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.1);
        }
        .sheet.active { bottom: 0; }
        .sheet-handle { width: 40px; height: 4px; background: #e0e0e0; margin: 0 auto 20px; border-radius: 10px; }
        .sheet-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

        #overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 1000; backdrop-filter: blur(2px); }
        #overlay.active { display: block; }
        
        #toast { 
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: #323232; color: #fff; padding: 12px 24px; border-radius: 8px; 
            font-size: 14px; z-index: 3000; transition: 0.3s;
        }
        #toast.active { transform: translateX(-50%) translateY(0); }

        .nav-box { display: flex; align-items: center; gap: 5px; padding: 15px; background: var(--bg-soft); border-top: 1px solid var(--border); justify-content: center; }
    </style>
</head>
<body>

<div id="login-screen">
    <h2 style="margin-bottom:20px; letter-spacing:2px;">ERP PRO LOGIN</h2>
    <input type="password" id="pass-input" placeholder="Password" class="input-ui" style="width:250px; padding:15px; text-align:center;">
    <button class="btn-ui btn-primary" onclick="checkLogin()" style="margin-top:15px; width:250px; padding:12px;">MASUK</button>
    <p id="login-msg" style="color:red; font-size:12px; margin-top:10px;"></p>
</div>

<div id="overlay" onclick="closeAll()"></div>
<div id="toast">Notifikasi</div>

<div id="sheet-menu" class="sheet">
    <div class="sheet-handle"></div>
    <div id="menu-title" style="text-align:center; font-weight:600; margin-bottom:20px;">Opsi</div>
    <div class="sheet-grid">
        <button class="btn-ui" style="padding:15px" onclick="execAction('add_row')">TAMBAH BARIS</button>
        <button class="btn-ui" style="padding:15px" onclick="execAction('add_col')">TAMBAH KOLOM</button>
        <button class="btn-ui danger" style="padding:15px; color:var(--danger)" id="btn-del-row" onclick="execAction('del_row')">HAPUS BARIS</button>
    </div>
    <button onclick="closeModal()" style="width:100%; margin-top:15px; padding:15px; border:none; background:none; font-weight:600; color:var(--primary);">BATAL</button>
</div>

<div id="sheet-filter" class="sheet">
    <div class="sheet-handle"></div>
    <div id="filter-title" style="text-align:center; font-weight:600; margin-bottom:20px;">Filter & Urutkan</div>
    <div style="display:flex; flex-direction:column; gap:10px;">
        <button class="btn-ui" style="padding:15px" onclick="sortData('asc')">URUTKAN A-Z</button>
        <button class="btn-ui" style="padding:15px" onclick="sortData('desc')">URUTKAN Z-A</button>
        <button class="btn-ui" style="padding:15px; color:var(--primary); font-weight:600;" id="btn-edit-col" onclick="execAction('edit_header')">GANTI NAMA KOLOM</button>
    </div>
    <button onclick="closeModal()" style="width:100%; margin-top:15px; padding:15px; border:none; background:none; font-weight:600; color:var(--primary);">BATAL</button>
</div>

<div id="sidebar">
    <div class="sidebar-header">MENU UTAMA</div>
    <div id="menu-list" style="flex-grow: 1; overflow-y: auto;"></div>
    
    <div style="padding:10px 0; border-top:1px solid var(--border);">
        <button class="tab-btn" id="btn-new-table" onclick="createNewTable()">+ TABEL BARU</button>
        <button class="tab-btn" onclick="toggleDarkMode()">ðŸŒ™ GANTI TEMA</button>
        <hr style="border:0; border-top:1px solid var(--border); margin: 10px 25px;">
        <button class="tab-btn" onclick="logout()" style="color:var(--danger)">LOGOUT</button>
    </div>
</div>

<header>
    <button class="btn-ui" onclick="toggleSidebar()">MENU</button>
    <div id="disp-title" style="font-weight:600; font-size:14px;">MEMUAT...</div>
    <div style="display:flex; gap:8px;">
        <button class="btn-ui" onclick="openPopUp(null)">OPSI</button>
        <button class="btn-ui btn-primary" id="btn-save-main" onclick="saveData()">SIMPAN</button>
    </div>
</header>

<div class="toolbar">
    <input type="date" id="dateStart" class="input-ui">
    <input type="date" id="dateEnd" class="input-ui">
    <button class="btn-ui" onclick="findData()">FIND</button>
    <button class="btn-ui" onclick="exportToExcel()">EXPORT</button>
    <button class="btn-ui" id="btn-import" onclick="document.getElementById('importFile').click()">IMPORT</button>
    <input type="file" id="importFile" hidden onchange="importFromExcel(event)">
    <input type="text" id="searchInp" placeholder="CARI..." class="input-ui" style="width:100px" oninput="doSearch()">
</div>

<div class="table-container">
    <table id="mainTable">
        <thead><tr id="table-head"></tr></thead>
        <tbody id="table-body"></tbody>
    </table>
    
    <div class="nav-box">
        <button class="btn-ui" onclick="changePage(currentPage-1)">PREV</button>
        <div id="page-info" style="font-size:12px; font-weight:700; padding:0 15px;">HAL 1</div>
        <button class="btn-ui" onclick="changePage(currentPage+1)">NEXT</button>
    </div>
</div>

<script>
    let activeKey = 'default';
    let currentPage = 1;
    let rowsPerPage = 50;
    let selectedRowIdx = null;
    let selectedColIdx = null;
    let searchQuery = "";
    let dateFilter = { start: "", end: "" };

    let config = JSON.parse(localStorage.getItem('erp_clean_conf')) || {
        default: { title: "DATA TRANSAKSI", cols: ["TANGGAL", "KETERANGAN", "DEBIT", "KREDIT", "SALDO"] }
    };
    let dataStore = JSON.parse(localStorage.getItem('erp_clean_data')) || {
        default: [["2024-01-01", "Saldo Awal", "0", "0", "0"]]
    };

    // --- LOGIN SYSTEM ---
    function checkLogin() {
        const pass = document.getElementById('pass-input').value;
        const loginScreen = document.getElementById('login-screen');
        if (pass === "admin123") {
            loginScreen.style.display = "none";
            notify("Login Admin Berhasil");
        } else if (pass === "owner") {
            loginScreen.style.display = "none";
            // Sembunyikan fitur edit untuk Owner
            document.getElementById('btn-save-main').style.display = "none";
            document.getElementById('btn-new-table').style.display = "none";
            document.getElementById('btn-import').style.display = "none";
            document.getElementById('btn-del-row').style.display = "none";
            document.getElementById('btn-edit-col').style.display = "none";
            notify("Mode Owner: View Only");
        } else {
            document.getElementById('login-msg').innerText = "Password Salah!";
        }
    }

    function logout() { if(confirm("Keluar dari sistem?")) location.reload(); }

    // --- DARK MODE ---
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('erp_dark', document.body.classList.contains('dark-mode'));
    }
    if(localStorage.getItem('erp_dark') === 'true') document.body.classList.add('dark-mode');

    function notify(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg; t.classList.add('active');
        setTimeout(() => t.classList.remove('active'), 2000);
    }

    function render() {
        document.getElementById('menu-list').innerHTML = Object.keys(config).map(k => 
            `<button class="tab-btn ${activeKey === k ? 'active' : ''}" onclick="switchTab('${k}')">${config[k].title}</button>`
        ).join('');

        document.getElementById('disp-title').innerText = config[activeKey].title;

        let cols = config[activeKey].cols;
        let hHtml = `<th style="width:50px">ID</th>`;
        cols.forEach((c, i) => {
            hHtml += `<th><div class="th-inner" onclick="openFilter(${i})"><span>${c}</span> <span>â–¼</span></div></th>`;
        });
        document.getElementById('table-head').innerHTML = hHtml;

        let filtered = dataStore[activeKey].map((row, index) => ({row, index}));
        if(searchQuery) filtered = filtered.filter(i => i.row.some(c => c.toString().toLowerCase().includes(searchQuery.toLowerCase())));
        if(dateFilter.start && dateFilter.end) filtered = filtered.filter(i => i.row[0] >= dateFilter.start && i.row[0] <= dateFilter.end);

        let totalPages = Math.ceil(filtered.length / rowsPerPage) || 1;
        let paginated = filtered.slice((currentPage - 1) * rowsPerPage, currentPage * rowsPerPage);

        let bHtml = paginated.map((item) => `
            <tr>
                <td class="row-num" onclick="openPopUp(${item.index})">${item.index + 1}</td>
                ${item.row.map((cell, ci) => `<td><input type="text" value="${cell}" oninput="upd(${item.index},${ci},this.value)"></td>`).join('')}
            </tr>
        `).join('');

        for(let i=0; i<5; i++) {
            bHtml += `<tr><td class="row-num"></td>${cols.map(()=>'<td></td>').join('')}</tr>`;
        }
        document.getElementById('table-body').innerHTML = bHtml;
        document.getElementById('page-info').innerText = `HAL ${currentPage} / ${totalPages}`;
    }

    function openPopUp(idx) { selectedRowIdx = idx; document.getElementById('sheet-menu').classList.add('active'); document.getElementById('overlay').classList.add('active'); }
    function openFilter(colIdx) { selectedColIdx = colIdx; document.getElementById('sheet-filter').classList.add('active'); document.getElementById('overlay').classList.add('active'); }
    function closeModal() { document.querySelectorAll('.sheet').forEach(s => s.classList.remove('active')); document.getElementById('overlay').classList.remove('active'); }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); document.getElementById('overlay').classList.toggle('active'); }
    function closeAll() { closeModal(); document.getElementById('sidebar').classList.remove('active'); document.getElementById('overlay').classList.remove('active'); }

    function execAction(type) {
        if (type === 'add_row') dataStore[activeKey].push(new Array(config[activeKey].cols.length).fill(""));
        if (type === 'add_col') { let n = prompt("NAMA KOLOM:"); if(n) { config[activeKey].cols.push(n.toUpperCase()); dataStore[activeKey].forEach(r => r.push("")); } }
        if (type === 'edit_header') { let n = prompt("GANTI NAMA:", config[activeKey].cols[selectedColIdx]); if(n) config[activeKey].cols[selectedColIdx] = n.toUpperCase(); }
        if (type === 'del_row' && selectedRowIdx !== null) { if(confirm("Hapus baris?")) dataStore[activeKey].splice(selectedRowIdx, 1); }
        render(); closeModal();
    }

    function sortData(dir) {
        dataStore[activeKey].sort((a, b) => {
            let vA = a[selectedColIdx], vB = b[selectedColIdx];
            return dir === 'asc' ? vA.localeCompare(vB) : vB.localeCompare(vA);
        });
        render(); closeModal(); notify("Diurutkan");
    }

    function createNewTable() {
        let n = prompt("NAMA TABEL:");
        if (n) {
            let k = 't' + Date.now();
            config[k] = { title: n.toUpperCase(), cols: ["TANGGAL", "KETERANGAN"] };
            dataStore[k] = [["", ""]];
            activeKey = k; render(); toggleSidebar();
        }
    }

    function upd(r, c, v) { dataStore[activeKey][r][c] = v; }
    function changePage(p) { if(p >= 1) { currentPage = p; render(); } }
    function switchTab(k) { activeKey = k; currentPage = 1; render(); toggleSidebar(); }
    function doSearch() { searchQuery = document.getElementById('searchInp').value; currentPage = 1; render(); }
    function findData() { dateFilter.start = document.getElementById('dateStart').value; dateFilter.end = document.getElementById('dateEnd').value; render(); }
    function saveData() { localStorage.setItem('erp_clean_conf', JSON.stringify(config)); localStorage.setItem('erp_clean_data', JSON.stringify(dataStore)); notify("Data Disimpan"); }
    
    function exportToExcel() {
        let ws = XLSX.utils.aoa_to_sheet([config[activeKey].cols, ...dataStore[activeKey]]);
        let wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Data");
        XLSX.writeFile(wb, config[activeKey].title + ".xlsx");
    }

    function importFromExcel(e) {
        let f = e.target.files[0]; let r = new FileReader();
        r.onload = function(ex) {
            let d = new Uint8Array(ex.target.result); let wb = XLSX.read(d, {type:'array'});
            let rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {header:1});
            if(rows.length > 0) { config[activeKey].cols = rows[0]; rows.shift(); dataStore[activeKey] = rows; render(); notify("Import Berhasil"); }
        }; r.readAsArrayBuffer(f);
    }

    render();
</script>
</body>
</html>
